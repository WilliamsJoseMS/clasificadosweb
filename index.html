<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clasificados Venezuela PRO - Directorio Nacional e Internacional</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-accent {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .gradient-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .gradient-warning {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }
        
        .card-hover {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateZ(0);
        }
        
        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .admin-panel {
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .whatsapp-btn {
            background: linear-gradient(135deg, #25D366, #128C7E);
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        }
        
        .whatsapp-btn:hover {
            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.4);
            transform: translateY(-2px);
        }
        
        .featured-badge {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            animation: pulse-glow 2s infinite;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        @keyframes pulse-glow {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            }
        }
        
        .category-icon {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            margin: 0 auto 12px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .category-icon:hover {
            transform: translateY(-5px) rotate(5deg);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        
        .stars {
            color: #fbbf24;
            filter: drop-shadow(0 2px 4px rgba(251, 191, 36, 0.3));
        }
        
        .navbar-sticky {
            backdrop-filter: blur(20px);
            background: rgba(102, 126, 234, 0.9);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .glass-effect {
            backdrop-filter: blur(16px);
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
        }
        
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 300px;
            padding: 16px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            transform: translateX(400px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast-success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .toast-error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .toast-info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }
        
        .input-focus {
            transition: all 0.3s ease;
        }
        
        .input-focus:focus {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .floating-action {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            box-shadow: 0 8px 25px rgba(240, 147, 251, 0.4);
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        .floating-action:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(240, 147, 251, 0.6);
        }
        
        .modal-backdrop {
            backdrop-filter: blur(8px);
            background: rgba(0, 0, 0, 0.5);
        }
        
        .modern-card {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .search-container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 249, 250, 0.9));
            backdrop-filter: blur(20px);
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        .status-online {
            background: #10b981;
        }
        
        .status-offline {
            background: #ef4444;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .loading-spinner {
            border: 2px solid #f3f4f6;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-blue-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white sticky top-0 z-50 navbar-sticky">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 rounded-full bg-white bg-opacity-20 flex items-center justify-center">
                        <i class="fas fa-map-marker-alt text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">Clasificados Venezuela PRO</h1>
                        <div class="flex items-center text-sm opacity-80">
                            <span class="status-indicator" id="connectionStatus"></span>
                            <span id="connectionText">Conectando...</span>
                        </div>
                    </div>
                </div>
                <nav class="hidden md:flex space-x-8">
                    <a href="#" onclick="showView('home')" class="nav-link hover:text-yellow-200 transition-all duration-300 font-medium">
                        <i class="fas fa-home mr-2"></i>Inicio
                    </a>
                    <a href="#" onclick="showView('categories')" class="nav-link hover:text-yellow-200 transition-all duration-300 font-medium">
                        <i class="fas fa-th-large mr-2"></i>Categor√≠as
                    </a>
                    <a href="#" onclick="showView('featured')" class="nav-link hover:text-yellow-200 transition-all duration-300 font-medium">
                        <i class="fas fa-star mr-2"></i>Destacados
                    </a>
                    <a href="#" onclick="showView('admin')" class="nav-link hover:text-yellow-200 transition-all duration-300 font-medium">
                        <i class="fas fa-cog mr-2"></i>Admin
                    </a>
                </nav>
                <div class="md:hidden">
                    <button onclick="toggleMobileMenu()" class="text-white hover:text-yellow-200 transition-colors">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobileMenu" class="hidden md:hidden glass-effect text-gray-800 shadow-2xl">
            <div class="px-4 py-4 space-y-3">
                <a href="#" onclick="showView('home')" class="block py-3 px-4 hover:bg-white hover:bg-opacity-50 rounded-lg transition-all">
                    <i class="fas fa-home mr-3"></i>Inicio
                </a>
                <a href="#" onclick="showView('categories')" class="block py-3 px-4 hover:bg-white hover:bg-opacity-50 rounded-lg transition-all">
                    <i class="fas fa-th-large mr-3"></i>Categor√≠as
                </a>
                <a href="#" onclick="showView('featured')" class="block py-3 px-4 hover:bg-white hover:bg-opacity-50 rounded-lg transition-all">
                    <i class="fas fa-star mr-3"></i>Destacados
                </a>
                <a href="#" onclick="showView('admin')" class="block py-3 px-4 hover:bg-white hover:bg-opacity-50 rounded-lg transition-all">
                    <i class="fas fa-cog mr-3"></i>Admin
                </a>
            </div>
        </div>
    </header>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <!-- Floating Action Button -->
    <button class="floating-action flex items-center justify-center" onclick="showView('admin')" title="Agregar Negocio">
        <i class="fas fa-plus text-white text-xl"></i>
    </button>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        
        <!-- Home View -->
        <div id="homeView" class="view fade-in">
            <!-- Hero Section -->
            <div class="text-center mb-12">
                <h2 class="text-4xl md:text-6xl font-bold text-gray-800 mb-4">
                    Encuentra tu <span class="bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">negocio ideal</span>
                </h2>
                <p class="text-xl text-gray-600 max-w-2xl mx-auto">
                    Directorio completo de negocios y servicios en Venezuela e internacional
                </p>
            </div>

            <!-- Search Section -->
            <div class="modern-card rounded-2xl p-8 mb-12 search-container">
                <div class="flex flex-col lg:flex-row gap-4 mb-6">
                    <div class="flex-1">
                        <div class="relative">
                            <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="text" id="searchInput" placeholder="Buscar negocios, servicios, productos..." 
                                   class="w-full pl-12 pr-4 py-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent input-focus bg-white">
                        </div>
                    </div>
                    <div class="flex-1">
                        <select id="categoryFilter" class="w-full px-4 py-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 input-focus bg-white">
                            <option value="">Todas las categor√≠as</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <select id="locationFilter" class="w-full px-4 py-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 input-focus bg-white">
                            <option value="">Todas las ubicaciones</option>
                        </select>
                    </div>
                    <button onclick="searchBusinesses()" class="px-8 py-4 btn-primary text-white rounded-xl font-medium">
                        <i class="fas fa-search mr-2"></i>Buscar
                    </button>
                </div>
                
                <!-- Advanced Filters -->
                <div class="flex flex-wrap gap-4 pt-6 border-t border-gray-200">
                    <select id="sortFilter" class="px-4 py-2 border border-gray-200 rounded-lg input-focus bg-white">
                        <option value="name">Ordenar por nombre</option>
                        <option value="rating">Por valoraci√≥n</option>
                        <option value="newest">M√°s recientes</option>
                        <option value="featured">Destacados primero</option>
                    </select>
                    <select id="priceFilter" class="px-4 py-2 border border-gray-200 rounded-lg input-focus bg-white">
                        <option value="">Todos los precios</option>
                        <option value="$">$ - Econ√≥mico</option>
                        <option value="$$">$$ - Moderado</option>
                        <option value="$$$">$$$ - Premium</option>
                    </select>
                    <button onclick="clearFilters()" class="px-4 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors">
                        <i class="fas fa-times mr-2"></i>Limpiar filtros
                    </button>
                </div>
            </div>

            <!-- Quick Categories -->
            <div class="modern-card rounded-2xl p-8 mb-12">
                <h3 class="text-2xl font-bold text-gray-800 mb-8 text-center">Categor√≠as Populares</h3>
                <div id="quickCategories" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6">
                    <!-- Categories will be populated by JavaScript -->
                </div>
            </div>

            <!-- Business Listings -->
            <div class="mb-6 flex justify-between items-center">
                <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-building mr-3 text-purple-600"></i>
                    <span id="businessCount">0</span>  Negocios encontrados
                </h3>
                <div class="flex gap-3">
                    <button onclick="changeView('grid')" id="gridViewBtn" class="p-3 btn-primary text-white rounded-xl">
                        <i class="fas fa-th-large"></i>
                    </button>
                    <button onclick="changeView('list')" id="listViewBtn" class="p-3 bg-gray-300 text-gray-600 rounded-xl hover:bg-gray-400 transition-colors">
                        <i class="fas fa-list"></i>
                    </button>
                </div>
            </div>
            
            <!-- Loading Skeleton -->
            <div id="loadingSkeleton" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="skeleton rounded-2xl h-64"></div>
                <div class="skeleton rounded-2xl h-64"></div>
                <div class="skeleton rounded-2xl h-64"></div>
            </div>
            
            <div id="businessListings" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Business cards will be populated by JavaScript -->
            </div>
        </div>

        <!-- Categories View -->
        <div id="categoriesView" class="view hidden fade-in">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-gray-800 mb-4">Todas las Categor√≠as</h2>
                <p class="text-xl text-gray-600">Explora negocios por categor√≠a</p>
            </div>
            <div id="allCategories" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- All categories will be populated here -->
            </div>
        </div>

        <!-- Featured View -->
        <div id="featuredView" class="view hidden fade-in">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-star text-yellow-500 mr-3"></i>Negocios Destacados
                </h2>
                <p class="text-xl text-gray-600">Los mejores negocios seleccionados especialmente</p>
            </div>
            <div id="featuredBusinesses" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Featured businesses will be populated here -->
            </div>
        </div>

        <!-- Admin View -->
        <div id="adminView" class="view hidden fade-in">
            <!-- Admin Login -->
            <div id="adminLogin" class="max-w-md mx-auto modern-card rounded-2xl p-8">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 rounded-full gradient-bg flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-cog text-3xl text-white"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Panel de Administraci√≥n</h2>
                    <p class="text-gray-600 mt-2">Gestiona tu directorio de negocios</p>
                </div>
                <div class="space-y-6">
                    <input type="password" id="adminPassword" placeholder="Contrase√±a de administrador" 
                           class="w-full px-4 py-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 input-focus">
                    <button onclick="adminLogin()" class="w-full btn-primary text-white py-4 rounded-xl font-medium">
                        <i class="fas fa-sign-in-alt mr-2"></i>Ingresar
                    </button>
                </div>
            </div>

            <!-- Admin Dashboard -->
            <div id="adminDashboard" class="hidden">
                <div class="flex flex-col lg:flex-row gap-8">
                    <!-- Admin Sidebar -->
                    <div class="lg:w-80 modern-card rounded-2xl p-6">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 rounded-full gradient-bg flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-user-shield text-2xl text-white"></i>
                            </div>
                            <h3 class="font-bold text-gray-800">Panel de Control</h3>
                            <p class="text-sm text-gray-600">Administrador</p>
                        </div>
                        <nav class="space-y-3">
                            <button onclick="showAdminSection('dashboard')" class="admin-nav-btn w-full text-left px-4 py-3 rounded-xl hover:bg-purple-50 transition-all font-medium">
                                <i class="fas fa-chart-dashboard mr-3 text-purple-600"></i>Dashboard
                            </button>
                            <button onclick="showAdminSection('businesses')" class="admin-nav-btn w-full text-left px-4 py-3 rounded-xl hover:bg-purple-50 transition-all font-medium">
                                <i class="fas fa-building mr-3 text-blue-600"></i>Gestionar Negocios
                            </button>
                            <button onclick="showAdminSection('add')" class="admin-nav-btn w-full text-left px-4 py-3 rounded-xl hover:bg-purple-50 transition-all font-medium">
                                <i class="fas fa-plus mr-3 text-green-600"></i>Agregar Negocio
                            </button>
                            <button onclick="showAdminSection('categories')" class="admin-nav-btn w-full text-left px-4 py-3 rounded-xl hover:bg-purple-50 transition-all font-medium">
                                <i class="fas fa-tags mr-3 text-orange-600"></i>Categor√≠as
                            </button>
                            <button onclick="showAdminSection('sync')" class="admin-nav-btn w-full text-left px-4 py-3 rounded-xl hover:bg-purple-50 transition-all font-medium">
                                <i class="fas fa-cloud mr-3 text-indigo-600"></i>Sincronizaci√≥n
                            </button>
                            <button onclick="adminLogout()" class="w-full text-left px-4 py-3 rounded-xl hover:bg-red-50 text-red-600 transition-all font-medium">
                                <i class="fas fa-sign-out-alt mr-3"></i>Cerrar Sesi√≥n
                            </button>
                        </nav>
                    </div>

                    <!-- Admin Content -->
                    <div class="flex-1 admin-panel">
                        <!-- Dashboard Section -->
                        <div id="dashboardSection" class="admin-section modern-card rounded-2xl p-8">
                            <h3 class="text-3xl font-bold text-gray-800 mb-8">Dashboard</h3>
                            
                            <!-- Stats Cards -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                                <div class="gradient-bg text-white p-6 rounded-2xl card-hover">
                                    <div class="flex items-center">
                                        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-4">
                                            <i class="fas fa-building text-2xl"></i>
                                        </div>
                                        <div>
                                            <div class="text-3xl font-bold" id="totalBusinesses">0</div>
                                            <div class="text-sm opacity-80">Total Negocios</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="gradient-success text-white p-6 rounded-2xl card-hover">
                                    <div class="flex items-center">
                                        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-4">
                                            <i class="fas fa-star text-2xl"></i>
                                        </div>
                                        <div>
                                            <div class="text-3xl font-bold" id="featuredBusinessesCount">0</div>
                                            <div class="text-sm opacity-80">Destacados</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="gradient-accent text-white p-6 rounded-2xl card-hover">
                                    <div class="flex items-center">
                                        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-4">
                                            <i class="fas fa-tags text-2xl"></i>
                                        </div>
                                        <div>
                                            <div class="text-3xl font-bold" id="totalCategories">0</div>
                                            <div class="text-sm opacity-80">Categor√≠as</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="gradient-warning text-gray-800 p-6 rounded-2xl card-hover">
                                    <div class="flex items-center">
                                        <div class="w-12 h-12 bg-white bg-opacity-60 rounded-xl flex items-center justify-center mr-4">
                                            <i class="fas fa-thumbs-up text-2xl"></i>
                                        </div>
                                        <div>
                                            <div class="text-3xl font-bold" id="totalLikes">0</div>
                                            <div class="text-sm opacity-80">Total Me Gusta</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Charts -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <div class="bg-white p-6 rounded-2xl shadow-lg">
                                    <h4 class="font-bold text-gray-800 mb-6 text-lg">Negocios por Categor√≠a</h4>
                                    <div style="height: 300px;">
                                        <canvas id="categoryChart"></canvas>
                                    </div>
                                </div>
                                <div class="bg-white p-6 rounded-2xl shadow-lg">
                                    <h4 class="font-bold text-gray-800 mb-6 text-lg">Valoraciones</h4>
                                    <div style="height: 300px;">
                                        <canvas id="ratingsChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Add Business Section -->
                        <div id="addSection" class="admin-section hidden modern-card rounded-2xl p-8">
                            <div class="mb-8">
                                <h3 class="text-3xl font-bold text-gray-800 mb-2">Agregar Nuevo Negocio</h3>
                                <p class="text-gray-600">Completa la informaci√≥n del negocio</p>
                            </div>
                            
                            <form id="businessForm" class="space-y-8">
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    <!-- Basic Information -->
                                    <div class="space-y-6">
                                        <h4 class="font-bold text-gray-700 text-lg border-b border-gray-200 pb-2">Informaci√≥n B√°sica</h4>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Nombre del Negocio *</label>
                                            <input type="text" id="businessName" required
                                                   class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 input-focus">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Encargado/Contacto</label>
                                            <input type="text" id="contactName"
                                                   class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 input-focus">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Categor√≠a *</label>
                                            <select id="businessCategory" required
                                                    class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 input-focus">
                                                <option value="">Seleccionar categor√≠a</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Descripci√≥n</label>
                                            <textarea id="businessDescription" rows="4"
                                                      class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 input-focus"></textarea>
                                        </div>
                                    </div>

                                    <!-- Contact Information -->
                                    <div class="space-y-6">
                                        <h4 class="font-bold text-gray-700 text-lg border-b border-gray-200 pb-2">Informaci√≥n de Contacto</h4>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Tel√©fono Principal</label>
                                            <input type="tel" id="businessPhone"
                                                   class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 input-focus"
                                                   placeholder="+58 xxx-xxx-xxxx">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">WhatsApp</label>
                                            <input type="tel" id="businessWhatsapp"
                                                   class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 input-focus"
                                                   placeholder="+58 xxx-xxx-xxxx">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                            <input type="email" id="businessEmail"
                                                   class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 input-focus">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Instagram</label>
                                            <input type="text" id="businessInstagram"
                                                   class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 input-focus"
                                                   placeholder="@usuario">
                                        </div>
                                    </div>
                                </div>

                                <!-- Location and Additional Info -->
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    <div class="space-y-6">
                                        <h4 class="font-bold text-gray-700 text-lg border-b border-gray-200 pb-2">Ubicaci√≥n</h4>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Estado/Regi√≥n</label>
                                            <select id="businessState"
                                                    class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 input-focus">
                                                <option value="">Seleccionar estado</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Ciudad</label>
                                            <input type="text" id="businessCity"
                                                   class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 input-focus">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Direcci√≥n</label>
                                            <textarea id="businessAddress" rows="3"
                                                      class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 input-focus"></textarea>
                                        </div>
                                    </div>

                                    <div class="space-y-6">
                                        <h4 class="font-bold text-gray-700 text-lg border-b border-gray-200 pb-2">Informaci√≥n Adicional</h4>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Horarios de Atenci√≥n</label>
                                            <textarea id="businessHours" rows="3"
                                                      class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 input-focus"
                                                      placeholder="Ej: Lun-Vie 8:00-18:00"></textarea>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Servicios que Ofrece</label>
                                            <textarea id="businessServices" rows="3"
                                                      class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 input-focus"></textarea>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Rango de Precios</label>
                                            <select id="businessPriceRange"
                                                    class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 input-focus">
                                                <option value="">No especificado</option>
                                                <option value="$">$ - Econ√≥mico</option>
                                                <option value="$$">$$ - Moderado</option>
                                                <option value="$$$">$$$ - Premium</option>
                                            </select>
                                        </div>
                                        
                                        <div class="flex items-center">
                                            <input type="checkbox" id="businessFeatured" class="w-4 h-4 text-purple-600 mr-3 rounded">
                                            <label class="text-sm font-medium text-gray-700">Negocio Destacado</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex justify-end space-x-4 pt-8 border-t border-gray-200">
                                    <button type="button" onclick="clearForm()" 
                                            class="px-8 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors font-medium">
                                        Limpiar
                                    </button>
                                    <button type="submit" 
                                            class="px-8 py-3 btn-primary text-white rounded-xl font-medium">
                                        <i class="fas fa-save mr-2"></i>Guardar Negocio
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Manage Businesses Section -->
                        <div id="businessesSection" class="admin-section hidden modern-card rounded-2xl p-8">
                            <div class="flex justify-between items-center mb-8">
                                <div>
                                    <h3 class="text-3xl font-bold text-gray-800 mb-2">Gestionar Negocios</h3>
                                    <p class="text-gray-600">Administra todos los negocios registrados</p>
                                </div>
                                <div class="flex gap-3">
                                    <input type="text" id="adminSearchInput" placeholder="Buscar negocios..." 
                                           class="px-4 py-2 border border-gray-200 rounded-xl input-focus">
                                    <button onclick="refreshBusinessList()" class="px-4 py-2 btn-primary text-white rounded-xl">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="bg-gray-50">
                                            <th class="px-6 py-4 text-left font-medium text-gray-700 rounded-l-xl">Negocio</th>
                                            <th class="px-6 py-4 text-left font-medium text-gray-700">Categor√≠a</th>
                                            <th class="px-6 py-4 text-left font-medium text-gray-700">Ubicaci√≥n</th>
                                            <th class="px-6 py-4 text-left font-medium text-gray-700">Valoraci√≥n</th>
                                            <th class="px-6 py-4 text-left font-medium text-gray-700">Estado</th>
                                            <th class="px-6 py-4 text-left font-medium text-gray-700 rounded-r-xl">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="businessTableBody" class="divide-y divide-gray-100">
                                        <!-- Business rows will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Categories Section -->
                        <div id="categoriesSection" class="admin-section hidden modern-card rounded-2xl p-8">
                            <h3 class="text-3xl font-bold text-gray-800 mb-8">Gesti√≥n de Categor√≠as</h3>
                            <div id="categoryManagement">
                                <p class="text-gray-600">Gesti√≥n de categor√≠as en desarrollo...</p>
                            </div>
                        </div>

                        <!-- Sync Section -->
                        <div id="syncSection" class="admin-section hidden modern-card rounded-2xl p-8">
                            <div class="mb-8">
                                <h3 class="text-3xl font-bold text-gray-800 mb-2">Sincronizaci√≥n en Tiempo Real</h3>
                                <p class="text-gray-600">Sincronizaci√≥n autom√°tica activada con Firebase</p>
                            </div>
                            
                            <div class="space-y-8">
                                <div class="bg-blue-50 border border-blue-200 rounded-2xl p-6">
                                    <h4 class="font-bold text-blue-800 mb-4 flex items-center">
                                        <i class="fas fa-cloud mr-3"></i>Estado de Conexi√≥n
                                    </h4>
                                    <div class="flex items-center space-x-3">
                                        <div class="status-indicator" id="syncConnectionStatus"></div>
                                        <span class="text-blue-700 font-medium" id="syncConnectionText">Conectando...</span>
                                    </div>
                                    <p class="text-sm text-blue-600 mt-3">
                                        Los cambios se sincronizan autom√°ticamente entre todos los usuarios
                                    </p>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="bg-green-50 border border-green-200 rounded-2xl p-6">
                                        <h4 class="font-bold text-green-800 mb-3">
                                            <i class="fas fa-check-circle mr-2"></i>Funciones Activas
                                        </h4>
                                        <ul class="text-green-700 space-y-2">
                                            <li><i class="fas fa-dot-circle mr-2"></i>Sincronizaci√≥n autom√°tica</li>
                                            <li><i class="fas fa-dot-circle mr-2"></i>Actualizaciones en tiempo real</li>
                                            <li><i class="fas fa-dot-circle mr-2"></i>Base de datos en la nube</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="bg-purple-50 border border-purple-200 rounded-2xl p-6">
                                        <h4 class="font-bold text-purple-800 mb-3">
                                            <i class="fas fa-database mr-2"></i>Fuente de Datos
                                        </h4>
                                        <div class="text-purple-700">
                                            <div class="text-lg font-bold">Firebase Realtime DB</div>
                                            <div class="text-sm">Activa y Sincronizando</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <button onclick="exportData()" class="px-6 py-3 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors font-medium">
                                        <i class="fas fa-download mr-2"></i>Exportar Datos
                                    </button>
                                    <button onclick="clearAllData()" class="px-6 py-3 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-colors font-medium">
                                        <i class="fas fa-trash mr-2"></i>Limpiar Negocios
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12 mt-20">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <div class="w-16 h-16 rounded-full gradient-bg flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-map-marker-alt text-2xl text-white"></i>
                </div>
                <h3 class="text-2xl font-bold mb-4">Clasificados Venezuela PRO</h3>
                <p class="text-gray-400 mb-6 max-w-2xl mx-auto">
                    Conectando negocios en toda Venezuela e internacional. 
                    Plataforma moderna con sincronizaci√≥n en tiempo real.
                </p>
                <div class="flex justify-center space-x-8 text-sm">
                    <a href="#" class="hover:text-purple-400 transition-colors">T√©rminos de Uso</a>
                    <a href="#" class="hover:text-purple-400 transition-colors">Privacidad</a>
                    <a href="#" class="hover:text-purple-400 transition-colors">Contacto</a>
                    <a href="#" class="hover:text-purple-400 transition-colors">Ayuda</a>
                </div>
                <div class="mt-8 pt-8 border-t border-gray-800">
                    <p class="text-gray-500 text-sm">
                        ¬© 2025 Clasificados Venezuela PRO. Todos los derechos reservados.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Business Detail Modal -->
    <div id="businessModal" class="fixed inset-0 modal-backdrop hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modern-card rounded-2xl shadow-2xl max-w-2xl w-full max-h-90vh overflow-y-auto">
                <div id="businessModalContent">
                    <!-- Modal content will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // N. del programador: ¬°Aqu√≠ est√° tu configuraci√≥n personal de Firebase!
        const firebaseConfig = {
            apiKey: "AIzaSyCl-tYbsmVZRWzOMWDaCxY2pHU-hsAmMWk",
            authDomain: "clasificadosweb-5260e.firebaseapp.com",
            databaseURL: "https://clasificadosweb-5260e-default-rtdb.firebaseio.com",
            projectId: "clasificadosweb-5260e",
            storageBucket: "clasificadosweb-5260e.appspot.com",
            messagingSenderId: "655481395382",
            appId: "1:655481395382:web:d0daefb0f42ae165476e17"
        };

        // Global variables
        let businesses = [];
        let categories = [];
        let currentView = 'grid';
        let isAdminLoggedIn = false;
        let currentEditingId = null;
        let database = null;
        let isConnected = false;
        let categoryChartInstance = null;
        let ratingsChartInstance = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        // N. del programador: La funci√≥n de inicializaci√≥n ahora es m√°s simple y depende 100% de Firebase.
        function initializeApp() {
            try {
                firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                setupRealtimeSync(); // Esta es la funci√≥n clave que carga los datos y escucha los cambios.
            } catch (error) {
                console.error('Error al conectar con Firebase:', error);
                showToast('No se pudo conectar a la base de datos.', 'error');
                updateConnectionStatus(false);
            }
            
            setupEventListeners();
            populateStates(); // Esto no depende de la base de datos, as√≠ que se queda.
        }

        // N. del programador: Esta funci√≥n ahora es el coraz√≥n de la aplicaci√≥n. Escucha los cambios
        // en la base de datos en tiempo real y actualiza la interfaz para todos los usuarios.
        function setupRealtimeSync() {
            if (!database) return;
            
            database.ref('.info/connected').on('value', (snapshot) => {
                isConnected = snapshot.val();
                updateConnectionStatus(isConnected);
            });

            // Escucha CUALQUIER cambio en el nodo 'businesses' de la base de datos.
            database.ref('businesses').on('value', (snapshot) => {
                showLoadingSkeleton(); // Muestra el esqueleto mientras procesamos.
                if (snapshot.exists()) {
                    const dataFromFirebase = snapshot.val();
                    // Firebase devuelve un objeto, lo convertimos a un array que nuestro c√≥digo ya sabe manejar.
                    businesses = Object.keys(dataFromFirebase).map(key => ({ 
                        id: key, // El ID √∫nico que Firebase genera (ej. -NqXyZ...) es ahora el id del negocio.
                        ...dataFromFirebase[key] 
                    }));
                } else {
                    businesses = []; // Si no hay negocios en la DB, el array se vac√≠a.
                }
                
                // Una vez que tenemos los datos, actualizamos toda la interfaz.
                // Esto se ejecuta autom√°ticamente cada vez que agregas, editas o eliminas un negocio.
                displayBusinesses();
                updateStats();
                if (isAdminLoggedIn) {
                    refreshBusinessList();
                    updateCharts();
                }
            });

            // Hacemos lo mismo para las categor√≠as.
            database.ref('categories').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const dataFromFirebase = snapshot.val();
                    categories = Object.keys(dataFromFirebase).map(key => ({ id: key, ...dataFromFirebase[key] }));
                } else {
                    // Si no hay categor√≠as en la DB (primer uso), las creamos y las guardamos.
                    console.log("No hay categor√≠as en Firebase, creando las de por defecto...");
                    initializeDefaultCategories(); 
                    
                    const categoriesToSave = {};
                    categories.forEach(cat => {
                        // Firebase prefiere objetos, as√≠ que usamos el 'id' de la categor√≠a como clave.
                        categoriesToSave[cat.id] = { name: cat.name, icon: cat.icon, color: cat.color };
                    });
                    database.ref('categories').set(categoriesToSave);
                }
                populateCategories();
            });
        }

        function updateConnectionStatus(connected) {
            const statusIndicator = document.getElementById('connectionStatus');
            const statusText = document.getElementById('connectionText');
            const syncStatusIndicator = document.getElementById('syncConnectionStatus');
            const syncStatusText = document.getElementById('syncConnectionText');

            const onlineClass = 'status-indicator status-online';
            const offlineClass = 'status-indicator status-offline';
            const onlineText = 'Conectado';
            const offlineText = 'Sin conexi√≥n';
            
            if (connected) {
                if (statusIndicator) statusIndicator.className = onlineClass;
                if (statusText) statusText.textContent = onlineText;
                if (syncStatusIndicator) syncStatusIndicator.className = onlineClass;
                if (syncStatusText) syncStatusText.textContent = onlineText;
            } else {
                if (statusIndicator) statusIndicator.className = offlineClass;
                if (statusText) statusText.textContent = offlineText;
                if (syncStatusIndicator) syncStatusIndicator.className = offlineClass;
                if (syncStatusText) syncStatusText.textContent = offlineText;
                showToast('Conexi√≥n perdida. Intentando reconectar...', 'error');
            }
        }

        // Toast notification system
        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} mr-3"></i>
                        <span>${message}</span>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 400);
            }, duration);
        }

        // N. del programador: Esta funci√≥n ya no es necesaria, la l√≥gica de guardado est√° en cada acci√≥n (agregar, editar, etc.).
        // function syncData() {}

        // N. del programador: Esta funci√≥n ya no se usa para cargar datos, Firebase lo hace.
        // function loadData() {}

        function initializeDefaultCategories() {
            categories = [
                { id: 'restaurantes', name: 'Restaurantes y Comida', icon: 'fas fa-utensils', color: '#ef4444' },
                { id: 'servicios', name: 'Servicios Profesionales', icon: 'fas fa-briefcase', color: '#3b82f6' },
                { id: 'comercios', name: 'Comercios y Tiendas', icon: 'fas fa-store', color: '#10b981' },
                { id: 'salud', name: 'Salud y Belleza', icon: 'fas fa-heart', color: '#f59e0b' },
                { id: 'educacion', name: 'Educaci√≥n y Formaci√≥n', icon: 'fas fa-graduation-cap', color: '#8b5cf6' },
                { id: 'tecnologia', name: 'Tecnolog√≠a e Inform√°tica', icon: 'fas fa-laptop', color: '#06b6d4' },
                { id: 'construccion', name: 'Construcci√≥n y Reparaciones', icon: 'fas fa-hammer', color: '#f97316' },
                { id: 'transporte', name: 'Transporte y Log√≠stica', icon: 'fas fa-truck', color: '#84cc16' },
                { id: 'entretenimiento', name: 'Entretenimiento y Eventos', icon: 'fas fa-music', color: '#ec4899' },
                { id: 'inmobiliaria', name: 'Inmobiliaria', icon: 'fas fa-home', color: '#6366f1' },
                { id: 'automotriz', name: 'Automotriz', icon: 'fas fa-car', color: '#14b8a6' },
                { id: 'financiero', name: 'Financiero y Seguros', icon: 'fas fa-dollar-sign', color: '#f59e0b' },
                { id: 'legal', name: 'Legal y Consultor√≠a', icon: 'fas fa-balance-scale', color: '#6b7280' },
                { id: 'turismo', name: 'Turismo y Viajes', icon: 'fas fa-plane', color: '#0ea5e9' },
                { id: 'deportes', name: 'Deportes y Fitness', icon: 'fas fa-dumbbell', color: '#ef4444' },
                { id: 'arte', name: 'Arte y Cultura', icon: 'fas fa-palette', color: '#a855f7' },
                { id: 'otros', name: 'Otros Servicios', icon: 'fas fa-ellipsis-h', color: '#6b7280' }
            ];
        }

        // N. del programador: Ya no necesitamos inicializar datos de negocios falsos.
        // function initializeDefaultData() {}

        function setupEventListeners() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) searchInput.addEventListener('input', debounce(searchBusinesses, 300));
            
            const businessForm = document.getElementById('businessForm');
            if (businessForm) businessForm.addEventListener('submit', handleFormSubmit);

            ['categoryFilter', 'locationFilter', 'sortFilter', 'priceFilter'].forEach(id => {
                const element = document.getElementById(id);
                if (element) element.addEventListener('change', searchBusinesses);
            });

            const adminSearchInput = document.getElementById('adminSearchInput');
            if (adminSearchInput) adminSearchInput.addEventListener('input', debounce(refreshBusinessList, 300));
            
            document.getElementById('businessModal').addEventListener('click', function(event) {
                if (event.target === this) closeBusinessModal();
            });
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function populateCategories() {
            const categoryFilter = document.getElementById('categoryFilter');
            const businessCategory = document.getElementById('businessCategory');
            const quickCategories = document.getElementById('quickCategories');
            const allCategories = document.getElementById('allCategories');

            if (!categories.length) return;

            const sortedCategories = [...categories].sort((a, b) => a.name.localeCompare(b.name));
            
            if (categoryFilter) {
                categoryFilter.innerHTML = '<option value="">Todas las categor√≠as</option>';
                sortedCategories.forEach(cat => {
                    categoryFilter.innerHTML += `<option value="${cat.id}">${cat.name}</option>`;
                });
            }
            
            if (businessCategory) {
                businessCategory.innerHTML = '<option value="">Seleccionar categor√≠a</option>';
                sortedCategories.forEach(cat => {
                    businessCategory.innerHTML += `<option value="${cat.id}">${cat.name}</option>`;
                });
            }
            
            if (quickCategories) {
                quickCategories.innerHTML = '';
                categories.slice(0, 6).forEach(cat => {
                    quickCategories.innerHTML += `
                        <div class="text-center cursor-pointer hover:bg-white hover:bg-opacity-50 p-4 rounded-2xl transition-all duration-300 card-hover" 
                             onclick="filterByCategory('${cat.id}')">
                            <div class="category-icon mx-auto" style="background: linear-gradient(135deg, ${cat.color}20, ${cat.color}40); color: ${cat.color};">
                                <i class="${cat.icon} text-2xl"></i>
                            </div>
                            <div class="text-sm font-semibold text-gray-700">${cat.name}</div>
                        </div>
                    `;
                });
            }
            
            if (allCategories) {
                allCategories.innerHTML = '';
                sortedCategories.forEach(cat => {
                    const businessCount = businesses.filter(b => b.category === cat.id).length;
                    allCategories.innerHTML += `
                        <div class="modern-card rounded-2xl p-8 text-center card-hover cursor-pointer"
                             onclick="filterByCategory('${cat.id}')">
                            <div class="category-icon mx-auto mb-4" style="background: linear-gradient(135deg, ${cat.color}20, ${cat.color}40); color: ${cat.color};">
                                <i class="${cat.icon} text-3xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800 mb-3">${cat.name}</h3>
                            <p class="text-gray-600 font-medium">${businessCount} negocio${businessCount !== 1 ? 's' : ''}</p>
                            <div class="mt-4 w-full bg-gray-200 rounded-full h-2">
                                <div class="h-2 rounded-full" style="background: ${cat.color}; width: ${Math.min(100, businessCount * 5)}%"></div>
                            </div>
                        </div>
                    `;
                });
            }
        }

        function populateStates() {
            const states = [ 'Distrito Capital', 'Miranda', 'Carabobo', 'Zulia', 'Lara', 'Aragua', 'Anzo√°tegui', 'Bol√≠var', 'T√°chira', 'Falc√≥n', 'Yaracuy', 'Barinas', 'Portuguesa', 'Cojedes', 'Gu√°rico', 'Apure', 'Monagas', 'Sucre', 'Nueva Esparta', 'Trujillo', 'M√©rida', 'Vargas', 'Amazonas', 'Delta Amacuro', 'Internacional' ];
            const locationFilter = document.getElementById('locationFilter');
            const businessState = document.getElementById('businessState');
            
            if (locationFilter) {
                locationFilter.innerHTML = '<option value="">Todas las ubicaciones</option>';
                states.forEach(state => { locationFilter.innerHTML += `<option value="${state}">${state}</option>`; });
            }
            
            if (businessState) {
                businessState.innerHTML = '<option value="">Seleccionar estado</option>';
                states.forEach(state => { businessState.innerHTML += `<option value="${state}">${state}</option>`; });
            }
        }

        function showLoadingSkeleton() {
            document.getElementById('loadingSkeleton').classList.remove('hidden');
            document.getElementById('businessListings').classList.add('hidden');
        }

        function hideLoadingSkeleton() {
            document.getElementById('loadingSkeleton').classList.add('hidden');
            document.getElementById('businessListings').classList.remove('hidden');
        }

        function displayBusinesses(businessesToShow = null) {
            const businessListings = document.getElementById('businessListings');
            const businessCount = document.getElementById('businessCount');
            if (!businessListings) return;
            
            const toShow = businessesToShow || businesses;
                
            if (businessCount) businessCount.textContent = toShow.length;
            
            if (toShow.length === 0) {
                businessListings.innerHTML = `
                    <div class="col-span-full text-center py-20">
                        <div class="w-24 h-24 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-6">
                            <i class="fas fa-search text-4xl text-gray-400"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-600 mb-2">No se encontraron negocios</h3>
                        <p class="text-gray-500">Intenta con otros t√©rminos de b√∫squeda o agrega un nuevo negocio desde el panel de administrador.</p>
                    </div>
                `;
                hideLoadingSkeleton();
                return;
            }
            
            businessListings.innerHTML = '';
            toShow.forEach((business, index) => {
                const categoryData = categories.find(c => c.id === business.category) || { name: 'Sin categor√≠a', icon: 'fas fa-building', color: '#6b7280' };
                const rating = business.rating || 0;
                
                const card = `
                    <div class="modern-card rounded-2xl p-6 card-hover relative fade-in" style="animation-delay: ${index * 0.05}s">
                        ${business.featured ? '<div class="absolute top-4 right-4 featured-badge text-white px-3 py-1 rounded-full text-xs font-bold">‚≠ê DESTACADO</div>' : ''}
                        
                        <div class="flex items-start space-x-4 mb-4">
                            <div class="flex-shrink-0">
                                <div class="w-16 h-16 rounded-2xl flex items-center justify-center" style="background: linear-gradient(135deg, ${categoryData.color}20, ${categoryData.color}40); color: ${categoryData.color};">
                                    <i class="${categoryData.icon} text-xl"></i>
                                </div>
                            </div>
                            
                            <div class="flex-1 min-w-0">
                                <h3 class="text-xl font-bold text-gray-900 mb-1">${business.name}</h3>
                                <p class="text-sm text-gray-600 mb-2">${categoryData.name}</p>
                                
                                <div class="flex items-center mb-3">
                                    <div class="flex stars mr-2">
                                        ${generateStars(rating)}
                                    </div>
                                    <span class="text-sm text-gray-600 font-medium">(${rating.toFixed(1)})</span>
                                </div>
                            </div>
                        </div>
                        
                        <p class="text-gray-700 text-sm mb-4 leading-relaxed">${business.description || ''}</p>
                        
                        <div class="space-y-2 text-sm text-gray-600 mb-4">
                            ${business.contactName ? `<p class="flex items-center"><i class="fas fa-user mr-3 text-purple-500"></i>${business.contactName}</p>` : ''}
                            ${business.address ? `<p class="flex items-center"><i class="fas fa-map-marker-alt mr-3 text-red-500"></i>${business.address}</p>` : ''}
                        </div>
                        
                        <div class="border-t border-gray-100 pt-4">
                            <div class="flex flex-wrap gap-2 mb-4">
                                ${business.phone ? `<a href="tel:${business.phone}" class="px-3 py-2 bg-blue-100 text-blue-800 rounded-lg text-xs font-medium hover:bg-blue-200 transition-colors"><i class="fas fa-phone mr-1"></i>Llamar</a>` : ''}
                                ${business.whatsapp ? `<a href="https://wa.me/${business.whatsapp.replace(/[^\d]/g, '')}?text=Hola, vi tu negocio en Clasificados Venezuela" target="_blank" class="px-3 py-2 whatsapp-btn text-white rounded-lg text-xs font-medium"><i class="fab fa-whatsapp mr-1"></i>WhatsApp</a>` : ''}
                                ${business.instagram ? `<a href="https://instagram.com/${business.instagram.replace('@', '')}" target="_blank" class="px-3 py-2 bg-pink-100 text-pink-800 rounded-lg text-xs font-medium hover:bg-pink-200 transition-colors"><i class="fab fa-instagram mr-1"></i>Instagram</a>` : ''}
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <button onclick="voteBusiness('${business.id}', 'like')" class="flex items-center space-x-2 text-green-600 hover:text-green-700 transition-colors">
                                        <i class="fas fa-thumbs-up"></i>
                                        <span class="font-medium">${business.likes || 0}</span>
                                    </button>
                                    <button onclick="voteBusiness('${business.id}', 'dislike')" class="flex items-center space-x-2 text-red-600 hover:text-red-700 transition-colors">
                                        <i class="fas fa-thumbs-down"></i>
                                        <span class="font-medium">${business.dislikes || 0}</span>
                                    </button>
                                </div>
                                
                                <div class="flex space-x-3">
                                    <button onclick="shareBusiness('${business.id}')" class="text-gray-600 hover:text-purple-600 transition-colors" title="Compartir"><i class="fas fa-share-alt text-lg"></i></button>
                                    <button onclick="showBusinessDetail('${business.id}')" class="text-purple-600 hover:text-purple-700 transition-colors" title="Ver detalles"><i class="fas fa-eye text-lg"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                businessListings.innerHTML += card;
            });
            
            // Display featured businesses
            const featuredBusinessesContainer = document.getElementById('featuredBusinesses');
            if (featuredBusinessesContainer) {
                const featured = businesses.filter(b => b.featured);
                featuredBusinessesContainer.innerHTML = '';
                if(featured.length === 0) {
                     featuredBusinessesContainer.innerHTML = `<div class="col-span-full text-center py-10 text-gray-500">No hay negocios destacados en este momento.</div>`;
                } else {
                    featured.forEach((business, index) => {
                        const categoryData = categories.find(c => c.id === business.category) || { name: 'Sin categor√≠a', icon: 'fas fa-building', color: '#6b7280' };
                        const rating = business.rating || 0;
                        featuredBusinessesContainer.innerHTML += `
                            <div class="modern-card rounded-2xl p-6 card-hover relative fade-in" style="animation-delay: ${index * 0.1}s">
                                <div class="absolute top-4 right-4 featured-badge text-white px-3 py-1 rounded-full text-xs font-bold">‚≠ê DESTACADO</div>
                                <div class="flex items-start space-x-4 mb-4">
                                    <div class="flex-shrink-0">
                                        <div class="w-16 h-16 rounded-2xl flex items-center justify-center" style="background: linear-gradient(135deg, ${categoryData.color}20, ${categoryData.color}40); color: ${categoryData.color};"><i class="${categoryData.icon} text-xl"></i></div>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <h3 class="text-xl font-bold text-gray-900 mb-1">${business.name}</h3>
                                        <p class="text-sm text-gray-600 mb-2">${categoryData.name}</p>
                                        <div class="flex items-center mb-3"><div class="flex stars mr-2">${generateStars(rating)}</div><span class="text-sm text-gray-600 font-medium">(${rating.toFixed(1)})</span></div>
                                    </div>
                                </div>
                                <p class="text-gray-700 text-sm mb-4">${business.description || ''}</p>
                                <div class="border-t border-gray-100 pt-4">
                                    <div class="flex flex-wrap gap-2 mb-4">
                                        ${business.whatsapp ? `<a href="https://wa.me/${business.whatsapp.replace(/[^\d]/g, '')}?text=Hola, vi tu negocio destacado en Clasificados Venezuela" target="_blank" class="px-3 py-2 whatsapp-btn text-white rounded-lg text-xs font-medium"><i class="fab fa-whatsapp mr-1"></i>WhatsApp</a>` : ''}
                                        ${business.phone ? `<a href="tel:${business.phone}" class="px-3 py-2 bg-blue-100 text-blue-800 rounded-lg text-xs font-medium hover:bg-blue-200 transition-colors"><i class="fas fa-phone mr-1"></i>Llamar</a>` : ''}
                                    </div>
                                    <div class="flex items-center justify-end">
                                        <button onclick="showBusinessDetail('${business.id}')" class="text-purple-600 hover:text-purple-700 transition-colors" title="Ver detalles"><i class="fas fa-eye text-lg"></i></button>
                                    </div>
                                </div>
                            </div>`;
                    });
                }
            }
            
            hideLoadingSkeleton();
        }

        function generateStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) stars += '<i class="fas fa-star"></i>';
                else if (i - 0.5 <= rating) stars += '<i class="fas fa-star-half-alt"></i>';
                else stars += '<i class="far fa-star"></i>';
            }
            return stars;
        }

        function searchBusinesses() {
            const searchTerm = document.getElementById('searchInput')?.value.toLowerCase() || '';
            const categoryFilter = document.getElementById('categoryFilter')?.value || '';
            const locationFilter = document.getElementById('locationFilter')?.value || '';
            const sortFilter = document.getElementById('sortFilter')?.value || 'name';
            const priceFilter = document.getElementById('priceFilter')?.value || '';
            
            let filtered = businesses.filter(business => {
                const searchCorpus = `${business.name} ${business.description || ''} ${business.services || ''} ${business.contactName || ''}`.toLowerCase();
                const matchesSearch = !searchTerm || searchCorpus.includes(searchTerm);
                const matchesCategory = !categoryFilter || business.category === categoryFilter;
                const matchesLocation = !locationFilter || business.state === locationFilter;
                const matchesPrice = !priceFilter || business.priceRange === priceFilter;
                return matchesSearch && matchesCategory && matchesLocation && matchesPrice;
            });
            
            filtered.sort((a, b) => {
                if (sortFilter === 'featured') {
                    if (a.featured && !b.featured) return -1;
                    if (!a.featured && b.featured) return 1;
                }
                switch (sortFilter) {
                    case 'rating': return (b.rating || 0) - (a.rating || 0);
                    case 'newest': return new Date(b.dateAdded) - new Date(a.dateAdded);
                    default: return a.name.localeCompare(b.name);
                }
            });
            
            displayBusinesses(filtered);
        }

        function filterByCategory(categoryId) {
            document.getElementById('categoryFilter').value = categoryId;
            showView('home');
            searchBusinesses();
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('locationFilter').value = '';
            document.getElementById('sortFilter').value = 'name';
            document.getElementById('priceFilter').value = '';
            displayBusinesses();
            showToast('Filtros limpiados', 'info');
        }

        // N. del programador: Votar ahora usa una transacci√≥n de Firebase para ser m√°s seguro.
        // Y la actualizaci√≥n en pantalla es autom√°tica gracias al listener.
        function voteBusiness(businessId, voteType) {
            const userVotes = JSON.parse(localStorage.getItem('userVotes') || '{}');
            if (userVotes[businessId]) {
                showToast('Ya has votado por este negocio', 'error');
                return;
            }

            const businessRef = database.ref('businesses/' + businessId);
            businessRef.transaction(currentData => {
                if (currentData === null) {
                    return; 
                }
                if (voteType === 'like') {
                    currentData.likes = (currentData.likes || 0) + 1;
                } else {
                    currentData.dislikes = (currentData.dislikes || 0) + 1;
                }
                currentData.rating = ((currentData.likes || 0) / ((currentData.likes || 0) + (currentData.dislikes || 0))) * 5;
                return currentData;
            });
            
            userVotes[businessId] = voteType;
            localStorage.setItem('userVotes', JSON.stringify(userVotes));
            showToast('¬°Gracias por tu voto!', 'success');
        }

        function shareBusiness(businessId) {
            const business = businesses.find(b => b.id == businessId);
            if (!business) return;
            const url = window.location.href;
            const text = `¬°Mira este negocio en Clasificados Venezuela!\n\n${business.name}\n${business.description || ''}\n\n${url}`;
            if (navigator.share) {
                navigator.share({ title: business.name, text: text, url: url });
            } else {
                navigator.clipboard.writeText(text).then(() => {
                    showToast('Informaci√≥n del negocio copiada al portapapeles', 'success');
                });
            }
        }

        function showBusinessDetail(businessId) {
            const business = businesses.find(b => b.id == businessId);
            if (!business) return;
            const categoryData = categories.find(c => c.id === business.category) || { name: 'Sin categor√≠a', icon: 'fas fa-building', color: '#6b7280' };
            const rating = business.rating || 0;
            const modalContent = `
                <div class="p-8">
                    <div class="flex justify-between items-start mb-6">
                        <h2 class="text-3xl font-bold text-gray-900">${business.name}</h2>
                        <button onclick="closeBusinessModal()" class="text-gray-400 hover:text-gray-600 text-2xl"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="space-y-6">
                        <div class="flex items-center space-x-4">
                            <div class="w-16 h-16 rounded-2xl flex items-center justify-center" style="background: linear-gradient(135deg, ${categoryData.color}20, ${categoryData.color}40); color: ${categoryData.color};"><i class="${categoryData.icon} text-xl"></i></div>
                            <div>
                                <p class="font-bold text-gray-900 text-lg">${categoryData.name}</p>
                                <div class="flex items-center"><div class="flex stars mr-2">${generateStars(rating)}</div><span class="text-sm text-gray-600 font-medium">(${rating.toFixed(1)})</span></div>
                            </div>
                        </div>
                        ${business.description ? `<div class="bg-gray-50 rounded-2xl p-6"><p class="text-gray-700 leading-relaxed">${business.description}</p></div>` : ''}
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <h3 class="font-bold text-gray-800 text-lg">Informaci√≥n de Contacto</h3>
                                ${business.contactName ? `<p class="flex items-center"><i class="fas fa-user mr-3 text-purple-500"></i><span class="font-medium">${business.contactName}</span></p>` : ''}
                                ${business.phone ? `<p class="flex items-center"><i class="fas fa-phone mr-3 text-blue-500"></i><a href="tel:${business.phone}" class="text-blue-600 hover:underline font-medium">${business.phone}</a></p>` : ''}
                                ${business.email ? `<p class="flex items-center"><i class="fas fa-envelope mr-3 text-red-500"></i><a href="mailto:${business.email}" class="text-blue-600 hover:underline font-medium">${business.email}</a></p>` : ''}
                            </div>
                            <div class="space-y-4">
                                <h3 class="font-bold text-gray-800 text-lg">Ubicaci√≥n y Horario</h3>
                                ${business.address ? `<p class="flex items-center"><i class="fas fa-map-marker-alt mr-3 text-red-500"></i><span>${business.address}</span></p>` : ''}
                                ${business.city && business.state ? `<p class="flex items-center"><i class="fas fa-map mr-3 text-green-500"></i><span>${business.city}, ${business.state}</span></p>` : ''}
                                ${business.hours ? `<p class="flex items-center"><i class="fas fa-clock mr-3 text-blue-500"></i><span>${business.hours}</span></p>` : ''}
                            </div>
                        </div>
                        ${business.services ? `<div class="bg-blue-50 rounded-2xl p-6"><h3 class="font-bold text-gray-800 mb-3 text-lg">Servicios</h3><p class="text-gray-700 leading-relaxed">${business.services}</p></div>` : ''}
                        <div class="flex flex-wrap gap-4 pt-6 border-t border-gray-200">
                            ${business.whatsapp ? `<a href="https://wa.me/${business.whatsapp.replace(/[^\d]/g, '')}?text=Hola, vi tu negocio en Clasificados Venezuela" target="_blank" class="px-6 py-3 whatsapp-btn text-white rounded-xl font-medium"><i class="fab fa-whatsapp mr-2"></i>WhatsApp</a>` : ''}
                            ${business.instagram ? `<a href="https://instagram.com/${business.instagram.replace('@', '')}" target="_blank" class="px-6 py-3 bg-pink-600 text-white rounded-xl hover:bg-pink-700 transition-colors font-medium"><i class="fab fa-instagram mr-2"></i>Instagram</a>` : ''}
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('businessModalContent').innerHTML = modalContent;
            document.getElementById('businessModal').classList.remove('hidden');
        }

        function closeBusinessModal() {
            document.getElementById('businessModal').classList.add('hidden');
        }

        function showView(viewName) {
            document.querySelectorAll('.view').forEach(view => view.classList.add('hidden'));
            const targetView = document.getElementById(viewName + 'View');
            if (targetView) targetView.classList.remove('hidden');
            document.getElementById('mobileMenu').classList.add('hidden');
        }

        function toggleMobileMenu() {
            document.getElementById('mobileMenu').classList.toggle('hidden');
        }

        function changeView(viewType) {
            currentView = viewType;
            const gridBtn = document.getElementById('gridViewBtn');
            const listBtn = document.getElementById('listViewBtn');
            const isGrid = viewType === 'grid';
            
            gridBtn.className = `p-3 rounded-xl ${isGrid ? 'btn-primary text-white' : 'bg-gray-300 text-gray-600 hover:bg-gray-400 transition-colors'}`;
            listBtn.className = `p-3 rounded-xl ${!isGrid ? 'btn-primary text-white' : 'bg-gray-300 text-gray-600 hover:bg-gray-400 transition-colors'}`;
            document.getElementById('businessListings').className = isGrid ? 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8' : 'space-y-6';
            
            showToast(`Vista cambiada a ${isGrid ? 'cuadr√≠cula' : 'lista'}`, 'info');
        }

        function adminLogin() {
            if (document.getElementById('adminPassword').value === 'admin123') {
                isAdminLoggedIn = true;
                document.getElementById('adminLogin').classList.add('hidden');
                document.getElementById('adminDashboard').classList.remove('hidden');
                showAdminSection('dashboard');
                updateStats();
                updateCharts();
                showToast('Bienvenido al panel de administraci√≥n', 'success');
            } else {
                showToast('Contrase√±a incorrecta', 'error');
            }
        }

        function adminLogout() {
            isAdminLoggedIn = false;
            document.getElementById('adminLogin').classList.remove('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('adminPassword').value = '';
            showToast('Sesi√≥n cerrada correctamente', 'info');
            showView('home');
        }

        function showAdminSection(sectionName, event) {
            if (!isAdminLoggedIn) return;
            document.querySelectorAll('.admin-section').forEach(s => s.classList.add('hidden'));
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) targetSection.classList.remove('hidden');

            document.querySelectorAll('.admin-nav-btn').forEach(btn => btn.classList.remove('bg-purple-100', 'text-purple-800'));
            const activeBtn = event ? event.currentTarget : document.querySelector(`[onclick*="'${sectionName}'"]`);
            if (activeBtn) activeBtn.classList.add('bg-purple-100', 'text-purple-800');
            
            if (sectionName === 'businesses') refreshBusinessList();
            if (sectionName === 'dashboard') updateCharts();
        }

        // N. del programador: Esta funci√≥n ahora escribe directamente en Firebase.
        // Es m√°s simple y potente. No necesita actualizar la UI manualmente.
        function handleFormSubmit(event) {
            event.preventDefault();
            
            const businessData = {
                name: document.getElementById('businessName').value,
                contactName: document.getElementById('contactName').value,
                phone: document.getElementById('businessPhone').value,
                whatsapp: document.getElementById('businessWhatsapp').value,
                instagram: document.getElementById('businessInstagram').value,
                email: document.getElementById('businessEmail').value,
                address: document.getElementById('businessAddress').value,
                state: document.getElementById('businessState').value,
                city: document.getElementById('businessCity').value,
                category: document.getElementById('businessCategory').value,
                description: document.getElementById('businessDescription').value,
                hours: document.getElementById('businessHours').value,
                services: document.getElementById('businessServices').value,
                priceRange: document.getElementById('businessPriceRange').value,
                featured: document.getElementById('businessFeatured').checked,
                dateAdded: new Date().toISOString()
            };
            
            if (currentEditingId) {
                // Si estamos editando, actualizamos el registro existente.
                database.ref('businesses/' + currentEditingId).update(businessData)
                    .then(() => {
                        showToast('Negocio actualizado exitosamente', 'success');
                        clearForm();
                        showAdminSection('businesses');
                    })
                    .catch(error => showToast(`Error al actualizar: ${error.message}`, 'error'));
                currentEditingId = null;
            } else {
                // Si es nuevo, usamos push() para que Firebase genere un ID √∫nico.
                // Y a√±adimos los contadores iniciales.
                businessData.likes = 0;
                businessData.dislikes = 0;
                businessData.rating = 0;
                database.ref('businesses').push(businessData)
                    .then(() => {
                        showToast('Negocio agregado exitosamente', 'success');
                        clearForm();
                    })
                    .catch(error => showToast(`Error al agregar: ${error.message}`, 'error'));
            }
        }

        function clearForm() {
            document.getElementById('businessForm').reset();
            currentEditingId = null;
        }

        function editBusiness(businessId) {
            const business = businesses.find(b => b.id == businessId);
            if (!business) return;
            currentEditingId = businessId;
            
            Object.keys(business).forEach(key => {
                const element = document.getElementById(`business${key.charAt(0).toUpperCase() + key.slice(1)}`);
                if(element) {
                    if(element.type === 'checkbox') element.checked = business[key];
                    else element.value = business[key];
                }
            });
            
            showAdminSection('add');
            showToast(`Editando negocio: ${business.name}`, 'info');
            window.scrollTo(0, 0);
        }
        
        // N. del programador: Eliminar ahora es tan simple como enviar la orden a Firebase.
        function deleteBusiness(businessId) {
            const business = businesses.find(b => b.id == businessId);
            if (!business) return;
            
            if (confirm(`¬øEst√°s seguro de que quieres eliminar "${business.name}"? Esta acci√≥n no se puede deshacer.`)) {
                database.ref('businesses/' + businessId).remove()
                    .then(() => showToast(`"${business.name}" fue eliminado.`, 'success'))
                    .catch(error => showToast(`Error al eliminar: ${error.message}`, 'error'));
                // La UI se actualiza sola gracias al listener de 'value'.
            }
        }

        function refreshBusinessList() {
            const tableBody = document.getElementById('businessTableBody');
            if (!tableBody) return;
            
            const searchTerm = document.getElementById('adminSearchInput')?.value.toLowerCase() || '';
            const filtered = businesses.filter(b => b.name.toLowerCase().includes(searchTerm) || b.category.toLowerCase().includes(searchTerm));
            
            tableBody.innerHTML = '';
            filtered.forEach(business => {
                const categoryData = categories.find(c => c.id === business.category) || { name: 'Sin categor√≠a' };
                const row = `
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4"><div class="font-bold text-gray-900">${business.name}</div><div class="text-sm text-gray-600">${business.contactName || ''}</div></td>
                        <td class="px-6 py-4 text-sm text-gray-600">${categoryData.name}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">${business.city || ''}, ${business.state || ''}</td>
                        <td class="px-6 py-4"><div class="flex stars text-sm">${generateStars(business.rating || 0)}</div></td>
                        <td class="px-6 py-4">${business.featured ? '<span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-medium">Destacado</span>' : '<span class="px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-xs font-medium">Normal</span>'}</td>
                        <td class="px-6 py-4">
                            <div class="flex space-x-3">
                                <button onclick="editBusiness('${business.id}')" class="text-blue-600 hover:text-blue-700 transition-colors" title="Editar"><i class="fas fa-edit text-lg"></i></button>
                                <button onclick="deleteBusiness('${business.id}')" class="text-red-600 hover:text-red-700 transition-colors" title="Eliminar"><i class="fas fa-trash text-lg"></i></button>
                            </div>
                        </td>
                    </tr>`;
                tableBody.innerHTML += row;
            });
        }

        function updateStats() {
            if (document.getElementById('totalBusinesses')) 
                document.getElementById('totalBusinesses').textContent = businesses.length;
            if (document.getElementById('featuredBusinessesCount'))
                document.getElementById('featuredBusinessesCount').textContent = businesses.filter(b => b.featured).length;
            if (document.getElementById('totalCategories'))
                document.getElementById('totalCategories').textContent = categories.length;
            if (document.getElementById('totalLikes'))
                document.getElementById('totalLikes').textContent = businesses.reduce((sum, b) => sum + (b.likes || 0), 0);
        }

        function updateCharts() {
            if (!Chart || !isAdminLoggedIn) return;

            const categoryCtx = document.getElementById('categoryChart')?.getContext('2d');
            if (categoryCtx) {
                if(categoryChartInstance) categoryChartInstance.destroy();
                const categoryData = categories.map(cat => ({
                    label: cat.name,
                    count: businesses.filter(b => b.category === cat.id).length,
                    color: cat.color
                })).filter(d => d.count > 0);
                
                categoryChartInstance = new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: { labels: categoryData.map(d => d.label), datasets: [{ data: categoryData.map(d => d.count), backgroundColor: categoryData.map(d => d.color) }] },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
                });
            }
            
            const ratingsCtx = document.getElementById('ratingsChart')?.getContext('2d');
            if (ratingsCtx) {
                if(ratingsChartInstance) ratingsChartInstance.destroy();
                const totalLikes = businesses.reduce((sum, b) => sum + (b.likes || 0), 0);
                const totalDislikes = businesses.reduce((sum, b) => sum + (b.dislikes || 0), 0);
                
                ratingsChartInstance = new Chart(ratingsCtx, {
                    type: 'bar',
                    data: { labels: ['Me Gusta', 'No Me Gusta'], datasets: [{ data: [totalLikes, totalDislikes], backgroundColor: ['#10b981', '#ef4444'], borderRadius: 8 }] },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
                });
            }
        }

        function exportData() {
            const dataToExport = {
                businesses: businesses,
                categories: categories,
                exportDate: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `clasificados_venezuela_pro_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Datos exportados correctamente', 'success');
        }

        function clearAllData() {
            if (confirm('¬°ADVERTENCIA! ¬øEst√°s seguro de que quieres eliminar TODOS los negocios de la base de datos? Esta acci√≥n es PERMANENTE.')) {
                database.ref('businesses').remove()
                    .then(() => showToast('Todos los negocios han sido eliminados.', 'success'))
                    .catch(error => showToast(`Error al limpiar datos: ${error.message}`, 'error'));
            }
        }

    </script>
</body>
</html>
